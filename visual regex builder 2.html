<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Regex Builder Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #3498db;
            background: transparent;
            color: #3498db;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .mode-btn.active {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .visual-builder {
            display: none;
        }

        .visual-builder.active {
            display: block;
        }

        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .component-category {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #3498db;
        }

        .component-category h3 {
            font-size: 1rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .component-btn {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .component-btn:hover {
            background: #3498db;
            color: white;
            transform: translateX(5px);
        }

        .regex-display {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 1.1rem;
            margin-bottom: 15px;
            min-height: 50px;
            display: flex;
            align-items: center;
            position: relative;
            overflow-x: auto;
        }

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .test-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .test-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .matches {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 100px;
        }

        .match {
            background: #2ecc71;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 2px;
            display: inline-block;
            font-weight: 600;
        }

        .no-match {
            color: #7f8c8d;
            font-style: italic;
        }

        .explanation {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            font-size: 0.95rem;
        }

        .flags-section {
            margin-bottom: 20px;
        }

        .flags-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .flag-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .flag-option:hover {
            background: #e9ecef;
        }

        .flag-option input[type="checkbox"] {
            transform: scale(1.2);
        }

        .presets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 10px;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }

        .history {
            max-height: 200px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
        }

        .history-item {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-family: monospace;
            transition: all 0.2s ease;
            border-left: 3px solid #3498db;
        }

        .history-item:hover {
            background: #e8f4fd;
            transform: translateX(5px);
        }

        .advanced-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .control-group input, .control-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }

        .success-message {
            background: #2ecc71;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .component-grid {
                grid-template-columns: 1fr;
            }
            
            .advanced-controls {
                grid-template-columns: 1fr;
            }
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            white-space: nowrap;
            font-size: 0.8rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Visual Regex Builder Pro</h1>
            <p>Build, test, and understand regular expressions with professional-grade tools</p>
        </header>

        <div class="main-grid">
            <div class="panel">
                <h2>Pattern Builder</h2>
                
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="switchMode('visual')">Visual Builder</button>
                    <button class="mode-btn" onclick="switchMode('manual')">Manual Entry</button>
                </div>

                <div class="error-message" id="error-message"></div>
                <div class="success-message" id="success-message"></div>

                <div class="visual-builder active" id="visual-builder">
                    <div class="presets">
                        <button class="preset-btn" onclick="loadPreset('email')">Email</button>
                        <button class="preset-btn" onclick="loadPreset('phone')">Phone</button>
                        <button class="preset-btn" onclick="loadPreset('url')">URL</button>
                        <button class="preset-btn" onclick="loadPreset('ipv4')">IPv4</button>
                    </div>

                    <div class="component-grid">
                        <div class="component-category">
                            <h3>Basic Patterns</h3>
                            <button class="component-btn" onclick="addComponent('\\d')" data-tooltip="Matches any digit (0-9)">Any Digit</button>
                            <button class="component-btn" onclick="addComponent('\\w')" data-tooltip="Matches word characters (a-z, A-Z, 0-9, _)">Word Character</button>
                            <button class="component-btn" onclick="addComponent('\\s')" data-tooltip="Matches whitespace characters">Whitespace</button>
                            <button class="component-btn" onclick="addComponent('.')" data-tooltip="Matches any character except newline">Any Character</button>
                        </div>

                        <div class="component-category">
                            <h3>Quantifiers</h3>
                            <button class="component-btn" onclick="addQuantifier('*')" data-tooltip="Zero or more times">* (0 or more)</button>
                            <button class="component-btn" onclick="addQuantifier('+')" data-tooltip="One or more times">+ (1 or more)</button>
                            <button class="component-btn" onclick="addQuantifier('?')" data-tooltip="Zero or one time">? (0 or 1)</button>
                            <button class="component-btn" onclick="showQuantifierDialog()" data-tooltip="Specific number of times">{n,m} Custom</button>
                        </div>

                        <div class="component-category">
                            <h3>Character Classes</h3>
                            <button class="component-btn" onclick="addComponent('[a-z]')" data-tooltip="Lowercase letters">Lowercase</button>
                            <button class="component-btn" onclick="addComponent('[A-Z]')" data-tooltip="Uppercase letters">Uppercase</button>
                            <button class="component-btn" onclick="addComponent('[0-9]')" data-tooltip="Digits">Digits</button>
                            <button class="component-btn" onclick="showCustomClass()" data-tooltip="Create custom character class">Custom Class</button>
                        </div>

                        <div class="component-category">
                            <h3>Anchors</h3>
                            <button class="component-btn" onclick="addComponent('^')" data-tooltip="Start of string">Start ^</button>
                            <button class="component-btn" onclick="addComponent('$')" data-tooltip="End of string">End $</button>
                            <button class="component-btn" onclick="addComponent('\\b')" data-tooltip="Word boundary">Word Boundary</button>
                        </div>
                    </div>

                    <div class="advanced-controls">
                        <div class="control-group">
                            <label>Add Literal Text:</label>
                            <input type="text" id="literal-input" placeholder="Enter text to match literally">
                            <button onclick="addLiteral()" style="margin-top: 5px; width: 100%; padding: 8px; background: #3498db; color: white; border: none; border-radius: 4px;">Add</button>
                        </div>
                        <div class="control-group">
                            <label>Group Options:</label>
                            <button onclick="addComponent('(')" style="width: 48%; margin-right: 2%; padding: 8px; background: #2ecc71; color: white; border: none; border-radius: 4px;">Start Group</button>
                            <button onclick="addComponent(')')" style="width: 48%; margin-left: 2%; padding: 8px; background: #e74c3c; color: white; border: none; border-radius: 4px;">End Group</button>
                            <button onclick="addComponent('|')" style="width: 100%; margin-top: 5px; padding: 8px; background: #f39c12; color: white; border: none; border-radius: 4px;">OR (|)</button>
                        </div>
                    </div>
                </div>

                <div class="visual-builder" id="manual-builder">
                    <textarea id="manual-regex" placeholder="Enter your regular expression here..." style="width: 100%; height: 100px; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; font-size: 1rem; resize: vertical;"></textarea>
                </div>

                <div class="flags-section">
                    <h3 style="margin-bottom: 10px; color: #2c3e50;">Flags</h3>
                    <div class="flags-grid">
                        <label class="flag-option">
                            <input type="checkbox" id="flag-g" onchange="updateRegex()"> 
                            <span data-tooltip="Find all matches, not just the first">Global (g)</span>
                        </label>
                        <label class="flag-option">
                            <input type="checkbox" id="flag-i" onchange="updateRegex()"> 
                            <span data-tooltip="Case-insensitive matching">Ignore Case (i)</span>
                        </label>
                        <label class="flag-option">
                            <input type="checkbox" id="flag-m" onchange="updateRegex()"> 
                            <span data-tooltip="^ and $ match line breaks">Multiline (m)</span>
                        </label>
                        <label class="flag-option">
                            <input type="checkbox" id="flag-s" onchange="updateRegex()"> 
                            <span data-tooltip=". matches newline characters">Dotall (s)</span>
                        </label>
                    </div>
                </div>

                <div class="regex-display" id="regex-output">^$</div>
                <button class="copy-btn" onclick="copyRegex()">Copy</button>

                <div class="history">
                    <h3 style="margin-bottom: 10px; color: #2c3e50;">Pattern History</h3>
                    <div id="history-list"></div>
                </div>
            </div>

            <div class="panel">
                <h2>Live Testing</h2>
                
                <textarea class="test-input" id="test-input" placeholder="Enter test text here to see matches in real-time..." rows="6"></textarea>

                <div class="matches" id="matches-display">
                    <div class="no-match">Enter a pattern and test text to see matches</div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="match-count">0</div>
                        <div class="stat-label">Matches</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pattern-length">0</div>
                        <div class="stat-label">Pattern Length</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="complexity">Low</div>
                        <div class="stat-label">Complexity</div>
                    </div>
                </div>

                <div class="explanation" id="explanation">
                    Build a pattern using the visual builder or enter one manually to see a detailed explanation.
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPattern = '';
        let history = JSON.parse(localStorage.getItem('regexHistory') || '[]');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateRegex();
            loadHistory();
            
            // Add event listeners
            document.getElementById('test-input').addEventListener('input', testRegex);
            document.getElementById('manual-regex').addEventListener('input', function() {
                currentPattern = this.value;
                updateRegex();
            });
        });

        function switchMode(mode) {
            const buttons = document.querySelectorAll('.mode-btn');
            const builders = document.querySelectorAll('.visual-builder');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            builders.forEach(builder => builder.classList.remove('active'));
            
            document.querySelector(`[onclick="switchMode('${mode}')"]`).classList.add('active');
            
            if (mode === 'visual') {
                document.getElementById('visual-builder').classList.add('active');
            } else {
                document.getElementById('manual-builder').classList.add('active');
            }
        }

        function addComponent(component) {
            if (document.getElementById('manual-builder').classList.contains('active')) {
                const textarea = document.getElementById('manual-regex');
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const text = textarea.value;
                
                textarea.value = text.slice(0, start) + component + text.slice(end);
                textarea.focus();
                textarea.setSelectionRange(start + component.length, start + component.length);
                
                currentPattern = textarea.value;
            } else {
                currentPattern += component;
            }
            
            updateRegex();
            showSuccess(`Added: ${component}`);
        }

        function addQuantifier(quantifier) {
            if (currentPattern.length === 0) {
                showError('Add a pattern before applying quantifiers');
                return;
            }
            
            // Add quantifier to the last meaningful character/group
            currentPattern += quantifier;
            updateRegex();
            showSuccess(`Added quantifier: ${quantifier}`);
        }

        function addLiteral() {
            const input = document.getElementById('literal-input');
            const literal = input.value.trim();
            
            if (literal) {
                // Escape special regex characters
                const escaped = literal.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                addComponent(escaped);
                input.value = '';
            }
        }

        function showQuantifierDialog() {
            const min = prompt('Minimum occurrences:', '1');
            const max = prompt('Maximum occurrences (leave empty for no limit):', '');
            
            if (min !== null) {
                const quantifier = max ? `{${min},${max}}` : `{${min},}`;
                addQuantifier(quantifier);
            }
        }

        function showCustomClass() {
            const chars = prompt('Enter characters for custom class (e.g., abc123):', '');
            if (chars !== null) {
                addComponent(`[${chars}]`);
            }
        }

        function updateRegex() {
            const flags = getFlags();
            const display = document.getElementById('regex-output');
            
            // Update pattern from manual input if in manual mode
            if (document.getElementById('manual-builder').classList.contains('active')) {
                currentPattern = document.getElementById('manual-regex').value;
            }
            
            if (currentPattern) {
                display.textContent = `/${currentPattern}/${flags}`;
            } else {
                display.textContent = '/^$/' + flags;
            }
            
            document.getElementById('pattern-length').textContent = currentPattern.length;
            updateComplexity();
            testRegex();
            explainPattern();
        }

        function getFlags() {
            let flags = '';
            if (document.getElementById('flag-g').checked) flags += 'g';
            if (document.getElementById('flag-i').checked) flags += 'i';
            if (document.getElementById('flag-m').checked) flags += 'm';
            if (document.getElementById('flag-s').checked) flags += 's';
            return flags;
        }

        function testRegex() {
            const testText = document.getElementById('test-input').value;
            const matchesDiv = document.getElementById('matches-display');
            const matchCountDiv = document.getElementById('match-count');
            
            if (!currentPattern || !testText) {
                matchesDiv.innerHTML = '<div class="no-match">Enter a pattern and test text to see matches</div>';
                matchCountDiv.textContent = '0';
                return;
            }
            
            try {
                const flags = getFlags();
                const regex = new RegExp(currentPattern, flags);
                const matches = [...testText.matchAll(regex)];
                
                matchCountDiv.textContent = matches.length;
                
                if (matches.length === 0) {
                    matchesDiv.innerHTML = '<div class="no-match">No matches found</div>';
                } else {
                    let highlightedText = testText;
                    let offset = 0;
                    
                    matches.forEach(match => {
                        const start = match.index + offset;
                        const end = start + match[0].length;
                        const before = highlightedText.slice(0, start);
                        const matchText = highlightedText.slice(start, end);
                        const after = highlightedText.slice(end);
                        
                        highlightedText = before + `<span class="match">${matchText}</span>` + after;
                        offset += '<span class="match"></span>'.length;
                    });
                    
                    matchesDiv.innerHTML = highlightedText;
                }
            } catch (error) {
                matchesDiv.innerHTML = `<div class="no-match">Invalid regex: ${error.message}</div>`;
                matchCountDiv.textContent = '0';
            }
        }

        function updateComplexity() {
            const complexityDiv = document.getElementById('complexity');
            const length = currentPattern.length;
            const specialChars = (currentPattern.match(/[.*+?^${}()|[\]\\]/g) || []).length;
            
            let complexity = 'Low';
            if (length > 20 || specialChars > 5) {
                complexity = 'High';
            } else if (length > 10 || specialChars > 2) {
                complexity = 'Medium';
            }
            
            complexityDiv.textContent = complexity;
        }

        function explainPattern() {
            const explanationDiv = document.getElementById('explanation');
            
            if (!currentPattern) {
                explanationDiv.textContent = 'Build a pattern using the visual builder or enter one manually to see a detailed explanation.';
                return;
            }
            
            const explanations = [];
            let i = 0;
            
            while (i < currentPattern.length) {
                const char = currentPattern[i];
                const next = currentPattern[i + 1];
                
                switch (char) {
                    case '^':
                        explanations.push('Start of string');
                        break;
                    case '$':
                        explanations.push('End of string');
                        break;
                    case '.':
                        explanations.push('Any character (except newline)');
                        break;
                    case '*':
                        explanations.push('Zero or more of the preceding element');
                        break;
                    case '+':
                        explanations.push('One or more of the preceding element');
                        break;
                    case '?':
                        explanations.push('Zero or one of the preceding element');
                        break;
                    case '\\':
                        if (next) {
                            switch (next) {
                                case 'd':
                                    explanations.push('Any digit (0-9)');
                                    i++; // Skip next character
                                    break;
                                case 'w':
                                    explanations.push('Word character (a-z, A-Z, 0-9, _)');
                                    i++; // Skip next character
                                    break;
                                case 's':
                                    explanations.push('Whitespace character');
                                    i++; // Skip next character
                                    break;
                                case 'b':
                                    explanations.push('Word boundary');
                                    i++; // Skip next character
                                    break;
                                default:
                                    explanations.push(`Escaped character: ${next}`);
                                    i++; // Skip next character
                            }
                        }
                        break;
                    case '[':
                        const closingBracket = currentPattern.indexOf(']', i);
                        if (closingBracket !== -1) {
                            const charClass = currentPattern.slice(i + 1, closingBracket);
                            explanations.push(`Character class: ${charClass}`);
                            i = closingBracket;
                        }
                        break;
                    case '(':
                        explanations.push('Start of group');
                        break;
                    case ')':
                        explanations.push('End of group');
                        break;
                    case '|':
                        explanations.push('OR operator');
                        break;
                    case '{':
                        const closingBrace = currentPattern.indexOf('}', i);
                        if (closingBrace !== -1) {
                            const quantifier = currentPattern.slice(i + 1, closingBrace);
                            explanations.push(`Quantifier: {${quantifier}}`);
                            i = closingBrace;
                        }
                        break;
                    default:
                        explanations.push(`Literal character: '${char}'`);
                }
                i++;
            }
            
            explanationDiv.innerHTML = explanations.map(exp => `• ${exp}`).join('<br>');
        }

        function copyRegex() {
            const regexText = document.getElementById('regex-output').textContent;
            navigator.clipboard.writeText(regexText).then(() => {
                showSuccess('Regex copied to clipboard!');
            });
        }

        function loadPreset(type) {
            const presets = {
                email: '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}',
                phone: '\\(?\\d{3}\\)?[-.]?\\d{3}[-.]?\\d{4}',
                url: 'https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)',
                ipv4: '\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b'
            };
            
            currentPattern = presets[type];
            updateRegex();
            addToHistory(currentPattern);
            showSuccess(`Loaded ${type} preset`);
        }

        function addToHistory(pattern) {
            if (pattern && !history.includes(pattern)) {
                history.unshift(pattern);
                if (history.length > 10) {
                    history = history.slice(0, 10);
                }
                localStorage.setItem('regexHistory', JSON.stringify(history));
                loadHistory();
            }
        }

        function loadHistory() {
            const historyList = document.getElementById('history-list');
            if (history.length === 0) {
                historyList.innerHTML = '<div class="no-match">No patterns in history</div>';
                return;
            }
            
            historyList.innerHTML = history.map(pattern => 
                `<div class="history-item" onclick="loadFromHistory('${pattern.replace(/'/g, "\\'")}')">
                    ${pattern.length > 40 ? pattern.substring(0, 40) + '...' : pattern}
                </div>`
            ).join('');
        }

        function loadFromHistory(pattern) {
            currentPattern = pattern;
            updateRegex();
            showSuccess('Pattern loaded from history');
        }

        function clearPattern() {
            currentPattern = '';
            document.getElementById('manual-regex').value = '';
            updateRegex();
            showSuccess('Pattern cleared');
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 2000);
        }

        // Advanced features
        function exportPattern() {
            const data = {
                pattern: currentPattern,
                flags: getFlags(),
                timestamp: new Date().toISOString(),
                testCases: [document.getElementById('test-input').value]
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'regex-pattern.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccess('Pattern exported successfully');
        }

        function importPattern() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            currentPattern = data.pattern || '';
                            
                            // Set flags
                            document.getElementById('flag-g').checked = data.flags.includes('g');
                            document.getElementById('flag-i').checked = data.flags.includes('i');
                            document.getElementById('flag-m').checked = data.flags.includes('m');
                            document.getElementById('flag-s').checked = data.flags.includes('s');
                            
                            // Set test case if available
                            if (data.testCases && data.testCases[0]) {
                                document.getElementById('test-input').value = data.testCases[0];
                            }
                            
                            updateRegex();
                            addToHistory(currentPattern);
                            showSuccess('Pattern imported successfully');
                        } catch (error) {
                            showError('Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function generateTestCases() {
            if (!currentPattern) {
                showError('Create a pattern first');
                return;
            }
            
            const testCases = [
                'john.doe@example.com',
                'user123@test.org',
                'invalid-email',
                '(555) 123-4567',
                '555.123.4567',
                '5551234567',
                'https://www.example.com',
                'http://test.org/path',
                'not-a-url',
                '192.168.1.1',
                '10.0.0.1',
                '999.999.999.999'
            ];
            
            document.getElementById('test-input').value = testCases.join('\n');
            testRegex();
            showSuccess('Generated sample test cases');
        }

        function validateRegex() {
            try {
                new RegExp(currentPattern, getFlags());
                showSuccess('✓ Regex is valid');
                return true;
            } catch (error) {
                showError(`Invalid regex: ${error.message}`);
                return false;
            }
        }

        function optimizePattern() {
            if (!currentPattern) {
                showError('No pattern to optimize');
                return;
            }
            
            let optimized = currentPattern;
            
            // Basic optimizations
            optimized = optimized.replace(/\[\d\]/g, '\\d');
            optimized = optimized.replace(/\[a-zA-Z\]/g, '[a-zA-Z]');
            optimized = optimized.replace(/\.\*/g, '.*');
            
            if (optimized !== currentPattern) {
                currentPattern = optimized;
                updateRegex();
                showSuccess('Pattern optimized');
            } else {
                showSuccess('Pattern is already optimized');
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        testRegex();
                        break;
                    case 'c':
                        if (e.shiftKey) {
                            e.preventDefault();
                            copyRegex();
                        }
                        break;
                    case 'z':
                        e.preventDefault();
                        if (history.length > 0) {
                            loadFromHistory(history[0]);
                        }
                        break;
                    case 'Delete':
                        e.preventDefault();
                        clearPattern();
                        break;
                }
            }
        });

        // Performance monitoring
        function measurePerformance() {
            const testText = document.getElementById('test-input').value;
            if (!currentPattern || !testText) return;
            
            const start = performance.now();
            try {
                const regex = new RegExp(currentPattern, getFlags());
                const matches = [...testText.matchAll(regex)];
                const end = performance.now();
                
                const time = (end - start).toFixed(2);
                console.log(`Regex execution time: ${time}ms`);
                
                if (time > 100) {
                    showError(`Slow pattern detected (${time}ms). Consider optimization.`);
                }
            } catch (error) {
                // Handle regex errors
            }
        }

        // Auto-save functionality
        let autoSaveTimer;
        function autoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                if (currentPattern) {
                    localStorage.setItem('currentRegex', JSON.stringify({
                        pattern: currentPattern,
                        flags: getFlags(),
                        testInput: document.getElementById('test-input').value
                    }));
                }
            }, 1000);
        }

        // Load auto-saved data
        function loadAutoSaved() {
            try {
                const saved = JSON.parse(localStorage.getItem('currentRegex') || '{}');
                if (saved.pattern) {
                    currentPattern = saved.pattern;
                    
                    // Restore flags
                    if (saved.flags) {
                        document.getElementById('flag-g').checked = saved.flags.includes('g');
                        document.getElementById('flag-i').checked = saved.flags.includes('i');
                        document.getElementById('flag-m').checked = saved.flags.includes('m');
                        document.getElementById('flag-s').checked = saved.flags.includes('s');
                    }
                    
                    // Restore test input
                    if (saved.testInput) {
                        document.getElementById('test-input').value = saved.testInput;
                    }
                    
                    updateRegex();
                }
            } catch (error) {
                console.log('No auto-saved data found');
            }
        }

        // Initialize auto-save
        document.addEventListener('DOMContentLoaded', function() {
            loadAutoSaved();
            
            // Add auto-save listeners
            document.getElementById('test-input').addEventListener('input', autoSave);
            document.getElementById('manual-regex').addEventListener('input', autoSave);
        });

        // Add performance monitoring to regex testing
        const originalTestRegex = testRegex;
        testRegex = function() {
            originalTestRegex();
            measurePerformance();
        };
    </script>

    <!-- Add control buttons at the bottom -->
    <div style="position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000;">
        <button onclick="clearPattern()" style="padding: 12px 20px; background: #e74c3c; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);">Clear</button>
        <button onclick="validateRegex()" style="padding: 12px 20px; background: #2ecc71; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);">Validate</button>
        <button onclick="optimizePattern()" style="padding: 12px 20px; background: #f39c12; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);">Optimize</button>
        <button onclick="generateTestCases()" style="padding: 12px 20px; background: #9b59b6; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3);">Test Cases</button>
        <button onclick="exportPattern()" style="padding: 12px 20px; background: #34495e; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(52, 73, 94, 0.3);">Export</button>
        <button onclick="importPattern()" style="padding: 12px 20px; background: #16a085; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 15px rgba(22, 160, 133, 0.3);">Import</button>
    </div>
</body>
</html>